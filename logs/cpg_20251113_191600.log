2025-11-13 19:16:12 - CPG_ImageGen - INFO - Using device: CUDA GPU: NVIDIA GeForce RTX 4070 Laptop GPU
2025-11-13 19:16:12 - CPG_ImageGen - INFO - Loaded environment variables from: D:\cpg-image-creation\.env
2025-11-13 19:16:12 - CPG_ImageGen - INFO - Importing Method1ControlNetInpaint...
2025-11-13 19:16:12 - CPG_ImageGen - INFO -   - Importing ImageLoader...
2025-11-13 19:16:12 - CPG_ImageGen - INFO -   - Importing ForegroundExtractor...
2025-11-13 19:16:13 - CPG_ImageGen - INFO -   - Importing MaskProcessor...
2025-11-13 19:16:13 - CPG_ImageGen - INFO -   - Importing CompositingEngine...
2025-11-13 19:16:13 - CPG_ImageGen - INFO -   - Importing Visualizer...
2025-11-13 19:16:13 - CPG_ImageGen - INFO -   [OK] All modules imported
2025-11-13 19:16:13 - CPG_ImageGen - INFO -   - Importing NanoBananaAPI...
2025-11-13 19:16:13 - CPG_ImageGen - INFO -   - Importing ControlNetHandler...
2025-11-13 19:16:13 - CPG_ImageGen - INFO -   [OK] All models imported
2025-11-13 19:16:13 - CPG_ImageGen - INFO - [OK] Method1ControlNetInpaint imported
2025-11-13 19:16:13 - CPG_ImageGen - INFO - Importing Method2NanoBananaComposite...
2025-11-13 19:16:13 - CPG_ImageGen - INFO - [OK] Method2NanoBananaComposite imported
2025-11-13 19:16:13 - CPG_ImageGen - INFO - Logger imported successfully
2025-11-13 19:16:13 - CPG_ImageGen - INFO - Importing methods...
2025-11-13 19:16:13 - CPG_ImageGen - INFO - Methods imported successfully
2025-11-13 19:16:13 - CPG_ImageGen - INFO - === CPG Image Generator Starting ===
2025-11-13 19:16:13 - CPG_ImageGen - INFO - Starting main function...
2025-11-13 19:16:13 - CPG_ImageGen - INFO - Arguments parsed: Namespace(input='input/soda_can2.HEIC', prompt=None, product=None, method='method2_nanobanan', style=None, color=None, output=None, config='config/config.yaml', api_key=None, variations=1, no_enhance=False)
2025-11-13 19:16:13 - CPG_ImageGen - INFO - Loading configuration...
2025-11-13 19:16:13 - CPG_ImageGen - INFO - Configuration loaded from config/config.yaml
2025-11-13 19:16:13 - CPG_ImageGen - INFO - Setting up directories...
2025-11-13 19:16:13 - CPG_ImageGen - INFO - Directories setup complete
2025-11-13 19:16:13 - CPG_ImageGen - INFO - Input image: input/soda_can2.HEIC
2025-11-13 19:16:13 - CPG_ImageGen - INFO - Prompt: AUTO-GENERATE
2025-11-13 19:16:13 - CPG_ImageGen - INFO - Product: AUTO-DETECT
2025-11-13 19:16:13 - CPG_ImageGen - INFO - Method: method2_nanobanan
2025-11-13 19:16:13 - CPG_ImageGen - INFO -  Starting Method 2: Nano Banana + Composite

2025-11-13 19:16:13 - CPG_ImageGen - INFO - ============================================================
2025-11-13 19:16:13 - CPG_ImageGen - INFO - Initializing Method 2: Nano Banana + Composite
2025-11-13 19:16:13 - CPG_ImageGen - INFO - ============================================================
2025-11-13 19:16:13 - CPG_ImageGen - INFO - ImageLoader initialized with support for all major formats
2025-11-13 19:16:13 - CPG_ImageGen - INFO - ForegroundExtractor initialized (model: u2net, will load on first use)
2025-11-13 19:16:13 - CPG_ImageGen - INFO - MaskProcessor initialized
2025-11-13 19:16:13 - CPG_ImageGen - INFO - CompositingEngine initialized
2025-11-13 19:16:13 - CPG_ImageGen - INFO - Visualizer initialized. Output: output\visualizations
2025-11-13 19:16:13 - CPG_ImageGen - INFO - API key loaded: AIzaSyBV...HRaA
2025-11-13 19:16:13 - CPG_ImageGen - INFO - NanoBananaAPI initialized
2025-11-13 19:16:13 - CPG_ImageGen - INFO - API key loaded: AIzaSyBV...HRaA
2025-11-13 19:16:13 - CPG_ImageGen - INFO - LLM prompt generation ENABLED with API key
2025-11-13 19:16:13 - CPG_ImageGen - INFO - SmartPromptEnhancer created (will initialize on first use)
2025-11-13 19:16:13 - CPG_ImageGen - INFO - Smart Prompt Enhancer enabled for backgrounds
2025-11-13 19:16:13 - CPG_ImageGen - INFO - Method 2 initialized successfully
2025-11-13 19:16:13 - CPG_ImageGen - INFO - Starting Method 2 generation for: input/soda_can2.HEIC
2025-11-13 19:16:13 - CPG_ImageGen - INFO - [Stage 1/6] Loading image...
2025-11-13 19:16:13 - CPG_ImageGen - INFO - Loading image: soda_can2.HEIC (.heic)
2025-11-13 19:16:13 - CPG_ImageGen - DEBUG - Original image mode: RGB
2025-11-13 19:16:13 - CPG_ImageGen - INFO - Resizing from 3024x4032 to 1536x2048
2025-11-13 19:16:14 - CPG_ImageGen - INFO - [Stage 2/6] Extracting foreground...
2025-11-13 19:16:14 - CPG_ImageGen - INFO - ============================================================
2025-11-13 19:16:14 - CPG_ImageGen - INFO - Initializing rembg (Background Removal)
2025-11-13 19:16:14 - CPG_ImageGen - INFO - ============================================================
2025-11-13 19:16:14 - CPG_ImageGen - INFO - Model: u2net
2025-11-13 19:16:14 - CPG_ImageGen - INFO - Downloading model on first run (this may take a few minutes)...
2025-11-13 19:16:14 - CPG_ImageGen - INFO - Model will be cached at: ~/.u2net/
2025-11-13 19:16:15 - CPG_ImageGen - INFO - ============================================================
2025-11-13 19:16:15 - CPG_ImageGen - INFO - rembg initialized successfully!
2025-11-13 19:16:15 - CPG_ImageGen - INFO - ============================================================
2025-11-13 19:16:15 - CPG_ImageGen - INFO - Extracting foreground from image...
2025-11-13 19:16:15 - CPG_ImageGen - DEBUG - Using alpha matting for better edge quality
2025-11-13 19:16:21 - CPG_ImageGen - INFO - Foreground extraction complete
2025-11-13 19:16:21 - CPG_ImageGen - INFO - [Stage 3/6] Processing mask...
2025-11-13 19:16:21 - CPG_ImageGen - INFO - Processing mask for: for_compositing
2025-11-13 19:16:21 - CPG_ImageGen - DEBUG - Compositing mask prepared
2025-11-13 19:16:21 - CPG_ImageGen - INFO - [Stage 4/6] Auto-generating creative background prompt...
2025-11-13 19:16:21 - CPG_ImageGen - INFO - Initializing Gemini for LLM prompt generation...
2025-11-13 19:16:21 - CPG_ImageGen - INFO - [SUCCESS] Gemini model initialized: gemini-2.5-flash
2025-11-13 19:16:21 - CPG_ImageGen - INFO - Generating prompts with Gemini LLM...
2025-11-13 19:16:46 - CPG_ImageGen - ERROR - LLM prompt generation failed: Invalid operation: The `response.text` quick accessor requires the response to contain a valid `Part`, but none were returned. The candidate's [finish_reason](https://ai.google.dev/api/generate-content#finishreason) is 2.
2025-11-13 19:16:46 - CPG_ImageGen - WARNING - Falling back to template prompts
2025-11-13 19:16:46 - CPG_ImageGen - WARNING - [FALLBACK] Using template prompts (LLM not available)
2025-11-13 19:16:46 - CPG_ImageGen - INFO - No prompt provided - using auto-generated background prompt
2025-11-13 19:16:46 - CPG_ImageGen - INFO - Background prompt: A creative background scene featuring vibrant gradient with neon geometric shapes. Style: bold, creative, eye-catching. High quality commercial photography background with perfect lighting. Background only, no products, no text, no foreground objects.
2025-11-13 19:16:46 - CPG_ImageGen - INFO - [Stage 5/6] Generating background with Nano Banana (Gemini 2.0 Flash)...
2025-11-13 19:16:46 - CPG_ImageGen - INFO - Initializing Gemini image generation model: gemini-2.5-flash-image
2025-11-13 19:16:46 - CPG_ImageGen - INFO - [SUCCESS] Gemini models initialized
2025-11-13 19:16:46 - CPG_ImageGen - INFO -   Image: gemini-2.5-flash-image
2025-11-13 19:16:46 - CPG_ImageGen - INFO -   Text: gemini-2.5-pro
2025-11-13 19:16:46 - CPG_ImageGen - INFO - Generating background with Gemini gemini-2.5-flash-image...
2025-11-13 19:16:46 - CPG_ImageGen - INFO - USING TEST PROMPT:
2025-11-13 19:16:46 - CPG_ImageGen - INFO - 
        Create a vibrant outdoor picnic scene background. The main element is a pink and purple checkered picnic blanket spread on bright green grass. Scattered on and around the blanket are colorful faux flowers in hot pink, yellow, and orange. A pair of trendy sunglasses with neon frames sits on the blanket. The scene is photographed from slightly above at a 45-degree angle. Bright natural sunlight creates soft shadows. The atmosphere is playful, youthful, and Instagram-worthy. The background should be sharp and detailed with natural bokeh in the distance showing more grass and flowers. Commercial photography quality, vibrant colors, Gen-Z aesthetic. Background only - no products, no text.
        
2025-11-13 19:16:57 - CPG_ImageGen - DEBUG - Cached tokens: 0
2025-11-13 19:16:57 - CPG_ImageGen - INFO - Resizing from (1024, 1024) to 1536x2048
2025-11-13 19:16:57 - CPG_ImageGen - INFO - [SUCCESS] Background generated: 1536x2048
2025-11-13 19:16:57 - CPG_ImageGen - INFO - [Stage 6/6] Compositing foreground onto background...
2025-11-13 19:16:57 - CPG_ImageGen - INFO - Starting compositing...
2025-11-13 19:16:57 - CPG_ImageGen - DEBUG - Edge refinement applied
2025-11-13 19:16:57 - CPG_ImageGen - DEBUG - Shadow added
2025-11-13 19:16:57 - CPG_ImageGen - DEBUG - Color matching applied (basic)
2025-11-13 19:16:57 - CPG_ImageGen - INFO - Compositing complete
2025-11-13 19:16:59 - CPG_ImageGen - INFO - Image saved to: output\soda_can2_method2_result.png
2025-11-13 19:16:59 - CPG_ImageGen - INFO - Creating visualization...
2025-11-13 19:16:59 - CPG_ImageGen - INFO - Visualizing 5 stages...
2025-11-13 19:16:59 - CPG_ImageGen - INFO - Visualization saved: output\visualizations\soda_can2_method2_pipeline.jpg
2025-11-13 19:17:00 - CPG_ImageGen - INFO - Comparison saved: output\visualizations\soda_can2_method2_comparison.jpg
2025-11-13 19:17:00 - CPG_ImageGen - INFO - === CPG Image Generator Finished ===
